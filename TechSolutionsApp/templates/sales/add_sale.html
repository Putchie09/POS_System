{% extends 'layout.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/sales/add_sale.css' %}">
{% endblock %}

{% block contenido %}
<div class="block-contenido">
    <h2>Agregar una nueva venta</h2>

    {% if messages %}
		<ul class="messages">
			{% for message in messages %}
				<li class="{{ message.tags }}">{{ message }}</li>
			{% endfor %}
		</ul>
	{% endif %}

    <!-- Formulario principal-->
    <form method="POST" class="form-venta">
        {% csrf_token %}

        <!-- Datos del cliente -->
        <div class="customer-grid">
            <div class="form-group">
                <label for="customer_name">Nombre:</label>
                <input type="text" name="customer_name" id="customer_name" required class="search-input"
                       value="{{ customer_data.customer_name|default:'' }}">
            </div>

            <div class="form-group">
                <label for="customer_last_name">Apellido:</label>
                <input type="text" name="customer_last_name" id="customer_last_name" required class="search-input"
                       value="{{ customer_data.customer_last_name|default:'' }}">
            </div>

            <div class="form-group">
                <label for="customer_id">Cédula:</label>
                <input type="text" name="customer_id" id="customer_id" required class="search-input"
                       value="{{ customer_data.customer_id|default:'' }}">
            </div>

            <div class="form-group">
                <label for="customer_email">Correo (opcional):</label>
                <input type="email" name="customer_email" id="customer_email" class="search-input"
                       value="{{ customer_data.customer_email|default:'' }}">
            </div>

            <div class="form-group">
                <label for="discount">Descuento (%):</label>
                <input type="number" name="discount" id="discount" min="0" max="100" class="search-input"
                       value="{{ customer_data.discount|default:'0' }}">
            </div>
        </div>

        <!-- Formulario de búsqueda -->
        <div class="search-and-save-container">
            <div class="search-container">
                <label for="q">Buscar por SKU o nombre:</label>
                <input type="text" id="q" name="q" value="{{ query }}" class="search-input">
                <button type="submit" formmethod="get" class="search-button">Buscar</button>
            </div>

            <button type="submit" class="submit-button">Guardar venta</button>
        </div>

        <!-- Lista de productos -->
        <h3>Productos</h3>
        <table class="product-table">
            <thead>
                <tr>
                    <th>SKU</th>
                    <th>Producto</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Cantidad</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>{{ product.sku }}</td>
                    <td>{{ product.name }}</td>
                    <td>₡{{ product.price }}</td>
                    <td>{{ product.stock }}</td>
                    <td>
                        <input type="number" name="quantity_{{ product.productId }}" min="0" max="{{ product.stock }}" value="0">
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </form>
</div>
{% endblock %}